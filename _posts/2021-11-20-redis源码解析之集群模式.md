---
layout: post
title:  "redis源码解析之集群模式"
date:   2021-11-20
desc: "redis cluster"
keywords: "redis 集群 cluster"
categories: [Database]
tags: [C/C++,redis,cluster]
icon: icon-html
---

Redis集群是Redis提供的分布式数据库方案，集群通过分片来进行数据共享，并提供复制和故障转移功能，需要注意的是redis cluster默认
使用的是0号数据库，并且不能更改<br/>

    //向一个节点node发送cluster meet命令，可以让node节点与ip和port所指定的节点握手，
    //握手成功后，就归到当前所在的集群中
    cluster meet <ip> <port>
    
    //查看当前cluster的节点
    cluster nodes
    
    {"cluster",clusterCommand,-2,"ar",0,NULL,0,0,0,0,0}
    
    //当cluster meet操作时源码
    if (!strcasecmp(c->argv[1]->ptr,"meet") && c->argc == 4) {
        long long port;

        if (getLongLongFromObject(c->argv[3], &port) != REDIS_OK) {
            addReplyErrorFormat(c,"Invalid TCP port specified: %s",
                                (char*)c->argv[3]->ptr);
            return;
        }

        if (clusterStartHandshake(c->argv[2]->ptr,port) == 0 &&
            errno == EINVAL)
        {
            addReplyErrorFormat(c,"Invalid node address specified: %s:%s",
                            (char*)c->argv[2]->ptr, (char*)c->argv[3]->ptr);
        } else {
            addReply(c,shared.ok);
        }
    }
    